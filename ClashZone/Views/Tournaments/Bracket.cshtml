@model ClashZone.ViewModels.BracketViewModel

@{
    // Title reflects the tournament name for improved SEO and clarity
    ViewData["Title"] = $"Drabinka – {Model.Tournament.Name}";
}

<div class="container mt-4" style="background-color:#0A0A0A; padding: 20px; border-radius: 10px; color: #f8f9fa;">
    <h2 class="mb-3">Drabinka – @Model.Tournament.Name</h2>
    <!-- Button to generate random results for the bracket -->
    <form asp-action="GenerateResults" asp-route-id="@Model.Tournament.Id" method="post" class="mb-3">
        <button type="submit" class="btn" style="background-color:#FF2B3E; border-color:#FF2B3E; color:#fff;">Wyniki</button>
    </form>

    <!-- Navigation tabs -->
    <ul class="nav nav-tabs mb-4" style="border-color:#FF2B3E;">
        <li class="nav-item">
            <a class="nav-link" asp-action="Details" asp-route-id="@Model.Tournament.Id" style="color:#FF2B3E;">Przegląd</a>
        </li>
        <li class="nav-item">
            <a class="nav-link" asp-action="Chat" asp-route-id="@Model.Tournament.Id" style="color:#FF2B3E;">Czat</a>
        </li>
        <li class="nav-item ">
            <a class="nav-link active" asp-action="Bracket" asp-route-id="@Model.Tournament.Id" style="color:#FF2B3E;">Drabinka</a>
        </li>
        <li class="nav-item">
            <a class="nav-link" asp-action="ParticipantsList" asp-route-id="@Model.Tournament.Id" style="color:#FF2B3E;">Uczestnicy</a>
        </li>
        <li class="nav-item">
            <a class="nav-link" asp-action="Matches" asp-route-id="@Model.Tournament.Id" style="color:#FF2B3E;">Mecze</a>
        </li>
        <li class="nav-item">
            <a class="nav-link" asp-action="Rules" asp-route-id="@Model.Tournament.Id" style="color:#FF2B3E;">Reguły</a>
        </li>
    </ul>

    @if (Model.Rounds.Count == 0)
    {
        <div class="alert alert-warning" role="alert" style="background-color:#1a1a1a; border-color:#444; color:#fff;">
            Brak informacji o drabince.  Upewnij się, że check‑in jest zakończony i turniej ma co najmniej dwie drużyny.
        </div>
    }
    else
    {
        <!-- Container for the entire bracket.  Uses flexbox to arrange rounds horizontally with horizontal scroll if needed. -->
        <div class="d-flex" style="overflow-x: auto; padding-bottom: 1rem;">
            @for (int r = 0; r < Model.Rounds.Count; r++)
            {
                var roundNumber = r + 1;
                <div class="me-4">
                    <h6 class="text-center mb-3">Runda @roundNumber</h6>
                    @foreach (var match in Model.Rounds[r])
                    {
                        <div class="mb-4 p-2" style="background-color:#1a1a1a; border:1px solid #444; border-radius:6px; min-width: 180px;">
                            <div class="d-flex justify-content-between align-items-center">
                                <span>@(match.Team1Name ?? "Bye")</span>
                                @if (match.Team1Name != null)
                                {
                                    <span class="badge"
                                          style="background-color:@((match.Team1Score.HasValue && match.Team2Score.HasValue && match.Team1Score.Value >= match.Team2Score.Value) ? "#FF2B3E" : "#6c757d");">
                                        @(match.Team1Score ?? 0)
                                    </span>
                                }
                            </div>
                            <div class="d-flex justify-content-between align-items-center mt-2">
                                <span>@(match.Team2Name ?? "Bye")</span>
                                @if (match.Team2Name != null)
                                {
                                    <span class="badge"
                                          style="background-color:@((match.Team1Score.HasValue && match.Team2Score.HasValue && match.Team2Score.Value > match.Team1Score.Value) ? "#FF2B3E" : "#6c757d");">
                                        @(match.Team2Score ?? 0)
                                    </span>
                                }
                            </div>
                        </div>
                    }
                </div>
            }
        </div>
    }
</div>